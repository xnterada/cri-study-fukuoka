# 第3回 ファイル操作

> ⚠️ **注意**  
> Windowsユーザーは[2回目以降の起動](https://github.com/xnterada/cri-study-fukuoka/blob/main/docs/linux/setup/win.md#2%E5%9B%9E%E7%9B%AE%E4%BB%A5%E9%99%8D%E3%81%AE%E8%B5%B7%E5%8B%95)に従い、WSLのターミナルを起動してから本ページの内容を進めてください。PowerShellやコマンドプロンプトではなく、WSLのターミナルを使用する必要があります。

## ファイル

Linuxにおける情報やデータの格納単位です。ファイルには、テキスト、画像、音声、プログラムなど、さまざまな種類の情報を保存できます。通常のデータファイルだけでなく、後ほど説明するディレクトリも特殊なファイルとして管理されます。

> 📝 **備考**  
> ファイルの概念はWindowsやmacOSの「ファイル」とあまり変わらないと考えてよいでしょう。

## ディレクトリ

ファイルを整理・分類するための容器のような存在です。WindowsやmacOSでは「フォルダ」と呼ばれることが多いですが、Linuxでは一般的に「ディレクトリ」と呼びます。ディレクトリの中にはファイルや他のディレクトリを格納でき、これにより階層構造を作ることができます。

> ℹ️ **情報**  
> ディレクトリも実際にはファイルの一種として扱われますが、その中身は格納されているファイルやディレクトリの情報（名前やメタデータ）になります。

### カレントディレクトリ

現在操作対象となっているディレクトリのことを指します。ターミナルでコマンドを実行する際、特にパスを指定しない場合は、このカレントディレクトリが基準となります。カレントディレクトリは、`pwd`コマンドで確認できます。

## パス

ファイルやディレクトリの場所を示す住所のようなものです。Linuxファイルシステムは、ルート（/）から始まる木構造になっており、この構造の中でファイルやディレクトリの位置を表現します。パスを使って、コマンドに対して「どのファイルを操作したいか」を明確に指示できます。

```
/home/xnter/cri-study-linux-workspace/file1.txt
```

上記の例では、`/`から始まって、`home` → `xnter` → `cri-study-linux-workspace` → `file1.txt`という階層を辿ることで、`file1.txt`ファイルの場所を特定しています。

> 📝 **備考**  
> `xnter`はログインしているユーザー名なので、自分のユーザー名で読み替えてください。

### 絶対パスと相対パス

パスには**絶対パス**と**相対パス**の2つの表現方法があります。

**絶対パス**は、ルートディレクトリ（/）から始まるファイルやディレクトリの完全な場所を表します。どこからでも同じファイルを確実に指定できます。

```
/home/xnter/cri-study-linux-workspace/file1.txt
```

**相対パス**は、現在の作業ディレクトリ（カレントディレクトリ）を基準とした場所を表します。現在いる場所によって指し示すファイルが変わります。

現在のディレクトリにある`cri-study-linux-workspace`ディレクトリ内の`file1.txt`：

```
./cri-study-linux-workspace/file1.txt
```

特殊なパス表現：

- `.`：現在のディレクトリ
- `..`：一つ上の階層のディレクトリ
- `~`：ホームディレクトリ（ログインユーザーの個人ディレクトリ）

> 💡 **ヒント**  
> 絶対パスは確実ですが長くなりがちです。相対パスは短く書けますが、現在の場所に依存するため注意が必要です。状況に応じて使い分けましょう。

## ファイル操作

Linuxでは、コマンドラインからファイルやディレクトリの作成、移動、削除などの操作を行います。ここでは、基本的なファイル操作コマンドを実例とともに紹介します。

### cd（change directory）

ディレクトリを移動するためのコマンドです。作業する場所を変更する際に使用します。

ホームディレクトリに移動：

```bash
cd ~
```

絶対パスで指定：

```bash
cd /home/xnter/cri-study-linux-workspace
```

相対パスで指定（現在がホームディレクトリでない場合は失敗します）：

```bash
cd cri-study-linux-workspace
```

一つ上の階層に移動：

```bash
cd ..
```

一つ前にいたディレクトリに戻る：

```bash
cd -
```

念のため、現在いる場所は`pwd`コマンドで確認できます。

```bash
pwd
```

> 📝 **備考**  
> `cd`コマンドは引数を省略すると、自動的にホームディレクトリに移動します。

### ls（list）

ディレクトリ内のファイルやディレクトリの一覧を表示するコマンドです。

現在のディレクトリの内容を表示：

```bash
ls
```

指定したディレクトリの内容を表示：

```bash
ls cri-study-linux-workspace
```

指定したディレクトリの内容を詳細情報付きで表示：

```bash
ls -l cri-study-linux-workspace
```

指定した**ディレクトリの**詳細情報付きで表示：

```bash
ls -ld cri-study-linux-workspace
```

現在のディレクトリを隠しファイルも含めて表示：

```bash
ls -a
```

現在のディレクトリの詳細情報と隠しファイルの両方を表示：

```bash
ls -la
```

> 📝 **備考**  
> `ls -l`の出力では、ファイルの権限、所有者、サイズ、更新日時などの情報が表示されます。ファイルの権限、所有者については次回以降で説明します。

### ファイルとディレクトリの見分け方

`ls -l`コマンドの出力では、最初の文字でファイルかディレクトリかを判別できます。

- `-`で始まる行はファイルを示します。
- `d`で始まる行はディレクトリを示します。

例：

```
$ ls -l cri-study-linux-workspace/
total 4
drwxr-xr-x 2 xnter xnter 4096 Jan  2 12:38 dir1
-rw-r--r-- 1 xnter xnter 0 Jan  2 11:59 file1.txt
-rw-r--r-- 1 xnter xnter 0 Jan  2 11:59 file2.txt
```

上記の例では、`dir1`がディレクトリ、`file1.txt`と`file2.txt`がファイルです。

### touch

新しい空のファイルを作成するか、既存ファイルのタイムスタンプを更新するコマンドです。今回は`cri-study-linux-workspace`ディレクトリに移動してコマンドを実行します。

```bash
cd ~/cri-study-linux-workspace
```

新しいファイルを作成：

```bash
touch src.txt
```

複数のファイルを一度に作成：

```bash
touch file1.txt file2.txt
```

`file1.txt`と`file2.txt`はすでに存在するので、新しいファイルは作成されず、既存ファイルの最終更新時刻が現在時刻に更新されます。

> ℹ️ **情報**  
> タイムスタンプはファイルの最終アクセス時間や最終変更時間などの情報です。

> 📝 **備考**  
> ファイル操作を行う際は、コマンド実行後に意図した操作が行われたかを`ls -l`コマンドで確認する癖をつけましょう。

### mkdir（make directory）

新しいディレクトリを作成するコマンドです。

新しいディレクトリを作成：

```bash
mkdir newdir
```

複数のディレクトリを一度に作成：

```bash
mkdir dir1 dir2 dir3
```

`dir1`ディレクトリは、すでに存在するのでエラーになりますが、他のディレクトリは新たに作成されます。

階層構造を一度に作成：

```bash
mkdir -p parent/child
```

`-p`オプションを使うと、指定したパスの途中に存在しないディレクトリがある場合でも、必要な親ディレクトリを自動的に作成してくれます。

### cp（copy）

ファイルやディレクトリをコピーするコマンドです。

ファイルをコピー（src.txtをもとに、dst.txtを作成）：

```bash
cp src.txt dst.txt
```

もし、すでに`dst.txt`が存在していた場合は上書きされます。

他のディレクトリにコピー：

```bash
cp src.txt parent/child
```

この場合、`parent/child/src.txt`としてコピーされます。もし、コピー先のファイル名を指定したい場合は、コピー先のパスにファイル名を含めて指定します。

```bash
cp src.txt parent/child/dst.txt
```

ディレクトリを再帰的にコピー：

```bash
cp -r parent newparent
```

`-r`オプションはディレクトリをコピーする際に必要です。このオプションにより、ディレクトリ内のすべてのファイルとサブディレクトリも含めてコピーされます。もし、すでに`newparent`ディレクトリが存在していた場合は、その中に`parent`ディレクトリが丸ごとコピーされます。

> ⚠️ **注意**  
> すでに存在するファイルをコピー先に指定すると、そのファイルは上書きされます。重要なファイルを上書きしないように注意してください。

### mv（move）

ファイルやディレクトリを移動、または名前を変更するコマンドです。

ファイル名を変更：

```bash
mv src.txt newsrc.txt
```

ファイルをディレクトリに移動：

```bash
mv newsrc.txt parent/child
```

これにより、`parent/child/newsrc.txt`として移動されます。

ディレクトリ名を変更：

```bash
mv parent oldparent
```

> ⚠️ **注意**  
> `mv`コマンドは元のファイルが削除されて新しい場所に移動します。コピーではなく移動なので注意してください。

### rm（remove）

ファイルやディレクトリを削除するコマンドです。削除したファイルは復旧が困難なので、使用時は十分注意してください。

ファイルを削除：

```bash
rm dst.txt
```

複数のファイルを削除：

```bash
rm file1.txt file2.txt
```

ディレクトリを再帰的に削除：

```bash
rm -r oldparent
```

`-r`オプションでディレクトリ内のすべてのファイルとサブディレクトリが削除されます。

> ⚠️ **注意**  
> `rm`コマンドはゴミ箱を介さず即座に削除します。重要なファイルを削除する前は必ず確認してください。

> 🚫 **エラー**  
> **打ってはいけないコマンド：**`sudo rm -rf /`は絶対に実行しないでください。これは管理者権限でシステム全体を強制的に削除するコマンドであり、実行するとシステムが完全に破壊され、事前にバックアップを行っていなければ復旧は困難です。

### find

ファイルやディレクトリを検索するコマンドです。指定した条件に合致するファイルを見つけることができます。非常に有用で、ファイル名、ファイルタイプ、ファイルサイズ、更新日時など、さまざまな条件で検索できます。押さえておきたいコマンドの一つです。

拡張子が`.txt`のファイルを検索：

```bash
find . -name "*.txt"
```

> ℹ️ **情報**  
> Linuxでは必ずしも`.txt`のような拡張子が必要であるとは限りません。Windowsとは異なり、ファイルの種類は拡張子ではなく、ファイル内容や属性によって判断されることが多いです。

すでに説明した通り、`.`は現在のディレクトリを示します。つまり、現在のディレクトリ以下でファイルを探索します。

「dir」+（1文字）のディレクトリを検索：

```bash
find . -type d -name "dir?"
```

`-type`オプションは検索対象のファイルタイプを指定します。`d`はディレクトリを意味します。ファイルを検索したいときは`f`を指定します。

### ワイルドカード

ファイル名の一部を省略して、パターンマッチングを行う特殊文字です。複数のファイルを一度に指定する際に便利です。

- **`*`**: 0文字以上の任意の文字列にマッチします。
- **`?`**: 1文字の任意の文字にマッチします。
- **`[]`**: 括弧内の文字のいずれか1文字にマッチします。

使用例：

「dir」を含むディレクトリを詳細表示：

```bash
ls -ld *dir*
```

「dir」+（1文字）のディレクトリにマッチ：

```bash
ls -ld dir?
```

dir1、dir2にマッチし、dir3にマッチしない：

```bash
ls -ld dir[12]
```

newで始まるすべてのファイルとディレクトリを削除：

```bash
rm -r new*
```

> 💡 **ヒント**  
> ワイルドカードは多くのコマンドで使用できます。ただし、予想以上に多くのファイルが対象になる場合があるので、特に削除系のコマンドでは事前に`ls`で確認することを推奨します。

## おわりに

ファイル操作は、Linuxを使用する上で最も基本的かつ重要なスキルです。今回学んだコマンドを組み合わせて、効率的にファイルシステムを操作できるようになりましょう。
