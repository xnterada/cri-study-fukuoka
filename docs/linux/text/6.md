# 第6回 ファイルの編集と実行

> ⚠️ **注意**  
> Windowsユーザーは[2回目以降の起動](https://github.com/xnterada/cri-study-fukuoka/blob/main/docs/linux/setup/win.md#2%E5%9B%9E%E7%9B%AE%E4%BB%A5%E9%99%8D%E3%81%AE%E8%B5%B7%E5%8B%95)に従い、WSLのターミナルを起動してから本ページの内容を進めてください。PowerShellやコマンドプロンプトではなく、WSLのターミナルを使用する必要があります。

## vim

Linuxシステムでは、設定ファイルの編集やプログラムの作成など、テキストファイルを編集する機会がよくあります。GUI環境が利用できない場合は、コマンドラインで動作するテキストエディタである**vim**がよく使われます。vimはviエディタを拡張・改良した高機能テキストエディタです。**モード型エディタ**と呼ばれ、異なるモードで異なる操作を行うという仕組みを持っています。

### vimの起動

既存のファイルを開く、または新しいファイルを作成：

```bash
vim file15.txt
```

### vimのモード

vimには主に3つのモードがあり、それぞれ異なる操作を行います。

### ノーマルモード（Normal Mode）

vimを起動した際のデフォルトモードです。カーソル移動、コピー、削除、検索などの操作を行います。他のモードから`Esc`キーを押すことでノーマルモードに戻ることができます。

### インサートモード（Insert Mode）

実際にテキストを入力するモードです。ノーマルモードから以下のキーでインサートモードに切り替えます。

- **`i`**: カーソル位置からテキスト挿入
- **`a`**: カーソルの次の位置からテキスト挿入
- **`o`**: 現在の行の下に新しい行を作成してテキスト挿入
- **`O`**: 現在の行の上に新しい行を作成してテキスト挿入

### コマンドラインモード（Command-line Mode）

ファイルの保存、終了、検索・置換などのコマンドを実行するモードです。ノーマルモードで`:`（コロン）を入力するとコマンドラインモードになります。

### vimの基本操作

### カーソル移動（ノーマルモード）

- **`h`**: 左に移動
- **`j`**: 下に移動
- **`k`**: 上に移動
- **`l`**: 右に移動
- **`0`**: 行の先頭に移動
- **`$`**: 行の末尾に移動
- **`gg`**: ファイルの先頭に移動
- **`G`**: ファイルの末尾に移動

### テキストの編集（ノーマルモード）

- **`x`**: カーソル位置の文字を削除
- **`dd`**: 現在の行を削除
- **`yy`**: 現在の行をコピー
- **`p`**: カーソル位置の後にペースト
- **`P`**: カーソル位置の前にペースト
- **`u`**: 元に戻す（Undo）

### 検索（ノーマルモード）

- **`/文字列`**: 文字列を前方検索
- **`?文字列`**: 文字列を後方検索
- **`n`**: 次の検索結果に移動
- **`N`**: 前の検索結果に移動

### よく使用するコマンド（コマンドラインモード）

- **`:set number`**: 行番号を表示
- **`:set nonumber`**: 行番号を非表示
- **`:10`**: 10行目に移動
- **`:%s/old/new/g`**: ファイル全体でoldをnewに置換
- **`:colorscheme desert`**: カラースキームをdesertに変更（色が見にくいときに便利）

### vimの終了方法

vimを終了するには、まず**ノーマルモード**になってから以下のコマンドを入力します：

- **`:q`**: 変更がない場合に終了
- **`:q!`**: 変更を保存せずに強制終了
- **`:w`**: ファイルを保存（終了しない）
- **`:wq`**: 保存して終了

### 実際にvimでファイルを編集してみましょう：

```bash
vim file16.txt
```

1. `i`キーを押してインサートモードに切り替え
2. 適当なテキストを入力
3. `Esc`キーでノーマルモードに戻る
4. `:wq`でファイルを保存して終了

## シェルスクリプト

> ℹ️ **情報**  
> 本カリキュラムではシェルスクリプトの作成と実行の基本を学びます。構文や実用的な例については、対象外とします。

複数のコマンドをまとめて記述したテキストファイルで、これを実行することで一連の処理を自動化できます。日常的な作業の自動化、システム管理、バックアップ処理など、さまざまな場面で活用されています。シェルスクリプトを書くことで、手動で行っていた繰り返し作業を効率化でき、ヒューマンエラーを減らすことができます。

> 💡 **ヒント**  
> シェルスクリプトは「コマンドの集合体」と考えると理解しやすいです。ターミナルで手動実行していたコマンドをファイルにまとめたものがシェルスクリプトです。

### シェルスクリプトファイルの作成

シェルスクリプトは通常`.sh`拡張子を付けたテキストファイルとして作成します。

### 基本的なシェルスクリプトの構造

```bash
vim hello.sh
```

次の内容を入力します：

```bash
#!/bin/bash
# This is a comment.
echo "Hello, World!"
echo "date: $(date)"
echo "user: $(whoami)"
```

### シバン（Shebang）

スクリプトファイルの1行目に記述する`#!/bin/bash`は**シバン**と呼ばれ、このスクリプトをどのインタプリタ（実行環境）で実行するかを指定します。ただし、`#`から始まる行はコメントとして扱われます。

- **`#!/bin/bash`**: Bashシェルで実行
- **`#!/bin/sh`**: 標準シェルで実行
- **`#!/usr/bin/env bash`**: 環境変数PATHからbashを検索して実行（より移植性が高い）

> 📝 **備考**  
> Pythonがインストールされている環境の場合、`#!/usr/bin/env python3`のように、シェルスクリプトだけでなく他の言語のインタプリタも指定できます。

### スクリプトファイルの実行

作成したシェルスクリプトを実行するには、まず実行権限を与える必要があります。

### 実行権限の付与

全ユーザーに実行権限を付与：

```bash
chmod 755 hello.sh
```

### スクリプトの実行方法

相対パスで実行：

```bash
./hello.sh
```

bashコマンドで直接実行（実行権限不要）：

```bash
bash hello.sh
```

> 💡 **ヒント**  
> `./`を付けるのは、現在のディレクトリがPATH環境変数に含まれていないためです。セキュリティ上の理由から、現在のディレクトリは自動的には検索されません。

## おわりに

vimとシェルスクリプトは、Linuxを効率的に使用するための重要なスキルです。特に、シェルスクリプトで作業を自動化することで、生産性を大幅に向上させることができます。
